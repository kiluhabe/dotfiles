#!/usr/bin/env bash
# shellcheck disable=SC1090
#
# bar - Dylan Araps

source ~/.cache/wal/colors.sh
enable -f /usr/lib64/bash/sleep sleep

dat() {
    dat="$(date "+%Y/%m/%d-%H:%M:%S")"
}

wif() {
    wif="$(iwgetid  -r)"
}

bat() {
    cur="$(< /sys/class/power_supply/BAT0/capacity)"
    sta="$(< /sys/class/power_supply/BAT0/status)"

    bat="$cur($sta)"
}

vol() {
    vol="$(amixer get Master |grep % |awk '{print $5}'|sed 's/[^0-9]//g'|head -n 1)"
}

bar_width=540
bar_height=64

center() {
    width="$(xdpyinfo | grep dimensions | sed -r 's/^[^0-9]*([0-9]+[0-9]+).*$/\1/')"
    echo "$((($width / 2) - ($bar_width / 2)))"
}

echo $background

for ((;;)); {
        dat; vol; wif; bat
        echo "%{c}VOL:$vol BATTERY:$bat $wif $dat"
        sleep 1
} | lemonbar -B "$color1" \
             -F "$foreground" \
             -f "Roboto Mono:size=10" \
             -f "DejaVu Sans:size=10" \
             -g "540x64+$(center)+80" \
             -b
