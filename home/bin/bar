#!/usr/bin/env bash
# shellcheck disable=SC1090
#
# bar - Dylan Araps

source ~/.cache/wal/colors.sh
enable -f /usr/lib64/bash/sleep sleep

dat() {
    dat="$(date "+%Y/%m/%d-%H:%M:%S")"
}

wif() {
    wif="$(iwgetid  -r)"
}

bat() {
    cur="$(< /sys/class/power_supply/BAT0/capacity)"
    sta="$(< /sys/class/power_supply/BAT0/status)"

    bat="$cur($sta)"
}

vol() {
    vol="$(amixer get Master |grep % |awk '{print $5}'|sed 's/[^0-9]//g'|head -n 1)"
}

gpu(){
    gpu="$(optimus-manager --print-mode | sed -e 's/Current mode : //g')"
}

bar_width=640
bar_height=24

center() {
    width="$(xdpyinfo | grep dimensions | sed -r 's/^[^0-9]*([0-9]+[0-9]+).*$/\1/')"
    echo "$((($width / 2) - ($bar_width / 2)))"
}

for ((;;)); {
        dat; vol; wif; bat; gpu;
        echo "%{c}VOL:$vol BATTERY:$bat GPU:$gpu $wif $dat"
        sleep 1
} | lemonbar -B "$color2" \
             -F "$foreground" \
             -f "Roboto Mono:size=10" \
             -f "DejaVu Sans:size=10" \
             -g "${bar_width}x${bar_height}+$(center)+80" \
             -b
